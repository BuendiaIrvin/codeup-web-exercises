<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="css/weather_map.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
<h1>Goodday Weather App!</h1>
<h2></h2>
<div class="mapping">
<div id='map' style='width: 800px; height: 300px;'></div>
</div>
<div id="weather" class="row">
</div>

<div id="icon"><img id="wicon" src="" alt="Weather icon"></div>

<script src="js/jquery-3.6.0.min.js"></script>
<script src="js/keys.js"></script>
<script src="js/mapbox-geocoder-utils.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
<script>
    mapboxgl.accessToken = MAPBOX_ACCESS_TOKEN;
    var map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/streets-v11', // style URL
        center: [-98.4936, 29.4241], // starting position [lng, lat]
        zoom: 9 // starting zoom
    });

    var marker = new mapboxgl.Marker({
        color: 'hotpink',
    })
        .setLngLat([-98.4936, 29.4241])
        .setDraggable(true)
        .addTo(map);

    marker.on('dragend', function () {
        var coords = marker.getLngLat().toArray();
        console.log(marker.getLngLat());
        $('#weather').html('');
        weather([marker.getLngLat().lng, marker.getLngLat().lat]);
    });



    function weather(x) {

        $.get("https://api.openweathermap.org/data/2.5/onecall?units=imperial&lat=" + x[1] + "&lon=" + x[0] + "&exclude=current,hourly,minutely&appid=" + WEATHER_MAP_TOKEN)
            .done(function (resp) {
                console.log(resp);
                var htmlStr= "";
                for (var i =0;i <= 5; i++) {
                    var today = resp.daily[i];
                    var todayDate = new Date(today.dt * 1000);
                    var description = resp.daily[i].weather[0].main
                    var tempature = resp.daily[i].temp.day
                    var humidity = resp.daily[i].humidity
                    var windSpeed = resp.daily[i].wind_speed

                    var iconcode = resp.daily[i].weather[0].icon;
                    var iconurl = "http://openweathermap.org/img/w/" + iconcode + ".png";
                    $('#wicon').attr('src', iconurl);


                    // <div id="icon"><img id="wicon" src="" alt="Weather icon"></div>
                    htmlStr += "<div class='card col-2' style='width: 18rem;'>";
                    htmlStr += '<div id="icon" class="card-header">' + '<img id="wicon" src="" alt="weather icon">' + todayDate + '</div>';
                    htmlStr += '<ul class="list-group list-group-flush">'
                    htmlStr += '<li class="list-group-item">' + "Description: " + description + '</li>';
                    htmlStr += '<li class="list-group-item">' + "Tempature: " + Math.round(tempature) + '</li>';
                    htmlStr += '<li class="list-group-item">' + "Humidity: " + humidity + '</li>';
                    htmlStr += '<li class="list-group-item">' + "Wind Speed: " + Math.round(windSpeed)+ '</li>';
                    htmlStr += '</div>';
                }
                $('#weather').append(htmlStr)
            });
    }
    weather([marker.getLngLat().lng, marker.getLngLat().lat]);
console.log(marker.getLngLat());




</script>
</body>
</html>

